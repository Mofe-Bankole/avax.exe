// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

//////////////////////////
// ENUMS
//////////////////////////

enum Role {
  USER
  STUDIO
}

enum AuthProvider {
  WALLET
  EMAIL
  GOOGLE
  X
}

enum SocialPlatform {
  X
  GOOGLE
  SPOTIFY
  WEBSITE
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}

enum GamePlatform {
  STEAM
  EPIC_GAMES
  GOG
  ITCH_IO
  PLAYSTATION
  XBOX
  NINTENDO
  APPLE_APPSTORE
  GOOGLE_PLAY
  OFFICIAL_SITE
  OTHER
}

//////////////////////////
// CORE USER IDENTITY
//////////////////////////

model User {
  id            String  @id @default(uuid())
  walletAddress String  @unique
  username      String  @unique
  email         String? @unique
  avatar        String?
  bio           String?
  role          Role    @default(USER)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // -----------------------------------------------
  // STUDIO-ONLY FIELDS (populated when role = STUDIO)
  // -----------------------------------------------
  studioName        String?
  studioDescription String?
  studioBannerUrl   String?
  studioLogoUrl     String?
  studioWebsite     String?
  studioTwitter     String?
  studioInstagram   String?
  studioDiscord     String?
  isVerified        Boolean @default(false)

  // Relations
  accounts       Account[]
  socials        Social[]
  games          Game[]         @relation("StudioGames")
  tournaments    Tournament[]   @relation("StudioTournaments")
  submissions    Submission[]
  sentMessages   Message[]      @relation("SentMessages")
  conversationsA Conversation[] @relation("ParticipantOne")
  conversationsB Conversation[] @relation("ParticipantTwo")
  hubs           Hub[]          @relation("HubMembers")
  hubMessages    HubMessage[]
}

//////////////////////////
// HUBS & COMMUNITIES
//////////////////////////

model Hub {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  isGlobal    Boolean  @default(false)
  createdAt   DateTime @default(now())

  members  User[]       @relation("HubMembers")
  messages HubMessage[]
}

model HubMessage {
  id        String   @id @default(uuid())
  hubId     String
  senderId  String
  content   String
  createdAt DateTime @default(now())

  hub    Hub  @relation(fields: [hubId], references: [id], onDelete: Cascade)
  sender User @relation(fields: [senderId], references: [id], onDelete: Cascade)
}

//////////////////////////
// AUTH METHODS
//////////////////////////

model Account {
  id                String       @id @default(uuid())
  userId            String
  provider          AuthProvider
  providerAccountId String
  passwordHash      String?

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

//////////////////////////
// SOCIAL LINKS
//////////////////////////

model Social {
  id       String         @id @default(uuid())
  userId   String
  platform SocialPlatform
  url      String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform])
}

//////////////////////////
// GAMES (Owned by Studios)
//////////////////////////

model Game {
  id          String   @id @default(uuid())
  name        String
  description String?
  studioId    String

  images   String[]
  coverUrl String?
  logo     String?

  createdAt DateTime @default(now())

  studio      User         @relation("StudioGames", fields: [studioId], references: [id], onDelete: Cascade)
  tournaments Tournament[]
  links       GameLink[]
}

model GameLink {
  id       String       @id @default(uuid())
  gameId   String
  platform GamePlatform
  url      String

  game Game @relation(fields: [gameId], references: [id], onDelete: Cascade)
}

//////////////////////////
// TOURNAMENTS
//////////////////////////

model Tournament {
  id          String   @id @default(uuid())
  title       String
  description String
  reward      String?
  startsAt    DateTime
  endsAt      DateTime

  gameId   String
  studioId String

  createdAt DateTime @default(now())

  game        Game         @relation(fields: [gameId], references: [id], onDelete: Cascade)
  studio      User         @relation("StudioTournaments", fields: [studioId], references: [id], onDelete: Cascade)
  submissions Submission[]
}

//////////////////////////
// SUBMISSIONS
//////////////////////////

model Submission {
  id           String           @id @default(uuid())
  tournamentId String
  userId       String
  proofText    String
  status       SubmissionStatus @default(PENDING)

  createdAt DateTime @default(now())

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, userId])
}

//////////////////////////
// 1v1 CHAT
//////////////////////////

model Conversation {
  id               String   @id @default(uuid())
  participantOneId String
  participantTwoId String
  createdAt        DateTime @default(now())

  participantOne User @relation("ParticipantOne", fields: [participantOneId], references: [id], onDelete: Cascade)
  participantTwo User @relation("ParticipantTwo", fields: [participantTwoId], references: [id], onDelete: Cascade)

  messages Message[]

  @@unique([participantOneId, participantTwoId])
}

model Message {
  id             String   @id @default(uuid())
  conversationId String
  senderId       String
  content        String
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User         @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
}