import{utils as t,pvmSerial as e,Short as n,Int as s}from"@avalabs/avalanchejs";import{parseAbiItem as i,hexToBytes as r}from"viem";async function o(t){return t.request({method:"eth_baseFee",params:[]})}async function a(t){return t.request({method:"eth_getChainConfig",params:[]})}async function c(t){return t.request({method:"eth_maxPriorityFeePerGas",params:[]})}async function u(t,{blk:e}){return t.request({method:"eth_feeConfig",params:[e??"latest"]})}async function h(t,{timestamp:e}){return t.request({method:"eth_getActiveRulesAt",params:[e??"latest"]})}function l(t,...e){if(!((n=t)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Expected Uint8Array");var n;if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function f(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const d=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),p=(t,e)=>t<<32-e|t>>>e;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function g(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!((e=t)instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name))throw new Error("expected Uint8Array, got "+typeof t);
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
var e;return t}let y=class{clone(){return this._cloneInto()}};function m(t){const e=e=>t().update(g(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}class b extends y{constructor(t,e,n,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=d(this.buffer)}update(t){f(this);const{view:e,buffer:n,blockLen:s}=this,i=(t=g(t)).length;for(let r=0;r<i;){const o=Math.min(s-this.pos,i-r);if(o===s){const e=d(t);for(;s<=i-r;r+=s)this.process(e,r);continue}n.set(t.subarray(r,r+o),this.pos),this.pos+=o,r+=o,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){f(this),function(t,e){l(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:s,isLE:i}=this;let{pos:r}=this;e[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>s-r&&(this.process(n,0),r=0);for(let t=r;t<s;t++)e[t]=0;!function(t,e,n,s){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,s);const i=BigInt(32),r=BigInt(4294967295),o=Number(n>>i&r),a=Number(n&r),c=s?4:0,u=s?0:4;t.setUint32(e+c,o,s),t.setUint32(e+u,a,s)}(n,s-8,BigInt(8*this.length),i),this.process(n,0);const o=d(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)o.setUint32(4*t,u[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:s,finished:i,destroyed:r,pos:o}=this;return t.length=s,t.pos=o,t.finished=i,t.destroyed=r,s%e&&t.buffer.set(n),t}}const w=(t,e,n)=>t&e^~t&n,v=(t,e,n)=>t&e^t&n^e&n,x=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),A=new Uint32Array(64);class I extends b{constructor(){super(64,32,8,!1),this.A=0|$[0],this.B=0|$[1],this.C=0|$[2],this.D=0|$[3],this.E=0|$[4],this.F=0|$[5],this.G=0|$[6],this.H=0|$[7]}get(){const{A:t,B:e,C:n,D:s,E:i,F:r,G:o,H:a}=this;return[t,e,n,s,i,r,o,a]}set(t,e,n,s,i,r,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|s,this.E=0|i,this.F=0|r,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)A[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=A[t-15],n=A[t-2],s=p(e,7)^p(e,18)^e>>>3,i=p(n,17)^p(n,19)^n>>>10;A[t]=i+A[t-7]+s+A[t-16]|0}let{A:n,B:s,C:i,D:r,E:o,F:a,G:c,H:u}=this;for(let t=0;t<64;t++){const e=u+(p(o,6)^p(o,11)^p(o,25))+w(o,a,c)+x[t]+A[t]|0,h=(p(n,2)^p(n,13)^p(n,22))+v(n,s,i)|0;u=c,c=a,a=o,o=r+e|0,r=i,i=s,s=n,n=e+h|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,r=r+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,s,i,r,o,a,c,u)}roundClean(){A.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const z=m(()=>new I);function B(t,{includeName:e=!1}={}){if("function"!==t.type&&"event"!==t.type&&"error"!==t.type)throw new Y(t.type);return`${t.name}(${P(t.inputs,{includeName:e})})`}function P(t,{includeName:e=!1}={}){return t?t.map(t=>function(t,{includeName:e}){if(t.type.startsWith("tuple"))return`(${P(t.components,{includeName:e})})${t.type.slice(5)}`;return t.type+(e&&t.name?` ${t.name}`:"")}(t,{includeName:e})).join(e?", ":","):""}function E(t,{strict:e=!0}={}){return!!t&&("string"==typeof t&&(e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")))}function U(t){return E(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const k="2.38.6";let L=({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,N=`viem@${k}`;class O extends Error{constructor(t,e={}){const n=e.cause instanceof O?e.cause.details:e.cause?.message?e.cause.message:e.details,s=e.cause instanceof O&&e.cause.docsPath||e.docsPath,i=L?.({...e,docsPath:s});super([t||"An error occurred.","",...e.metaMessages?[...e.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...n?[`Details: ${n}`]:[],...N?[`Version: ${N}`]:[]].join("\n"),e.cause?{cause:e.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=s,this.metaMessages=e.metaMessages,this.name=e.name??this.name,this.shortMessage=t,this.version=k}walk(t){return S(this,t)}}function S(t,e){return e?.(t)?t:t&&"object"==typeof t&&"cause"in t&&void 0!==t.cause?S(t.cause,e):e?null:t}class j extends O{constructor({data:t,params:e,size:n}){super([`Data size of ${n} bytes is too small for given parameters.`].join("\n"),{metaMessages:[`Params: (${P(e,{includeName:!0})})`,`Data:   ${t} (${n} bytes)`],name:"AbiDecodingDataSizeTooSmallError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t,this.params=e,this.size=n}}class M extends O{constructor(){super('Cannot decode zero data ("0x") with ABI parameters.',{name:"AbiDecodingZeroDataError"})}}class C extends O{constructor({expectedLength:t,givenLength:e,type:n}){super([`ABI encoding array length mismatch for type ${n}.`,`Expected length: ${t}`,`Given length: ${e}`].join("\n"),{name:"AbiEncodingArrayLengthMismatchError"})}}class D extends O{constructor({expectedSize:t,value:e}){super(`Size of bytes "${e}" (bytes${U(e)}) does not match expected size (bytes${t}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class T extends O{constructor({expectedLength:t,givenLength:e}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${t}`,`Given length (values): ${e}`].join("\n"),{name:"AbiEncodingLengthMismatchError"})}}class R extends O{constructor({docsPath:t}){super("Cannot extract event signature from empty topics.",{docsPath:t,name:"AbiEventSignatureEmptyTopicsError"})}}class F extends O{constructor(t,{docsPath:e}){super([`Encoded event signature "${t}" not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it.",`You can look up the signature here: https://openchain.xyz/signatures?query=${t}.`].join("\n"),{docsPath:e,name:"AbiEventSignatureNotFoundError"})}}class _ extends O{constructor(t,{docsPath:e}={}){super([`Event ${t?`"${t}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it."].join("\n"),{docsPath:e,name:"AbiEventNotFoundError"})}}class V extends O{constructor(t,e){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${t.type}\` in \`${B(t.abiItem)}\`, and`,`\`${e.type}\` in \`${B(e.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}class H extends O{constructor({abiItem:t,data:e,params:n,size:s}){super([`Data size of ${s} bytes is too small for non-indexed event parameters.`].join("\n"),{metaMessages:[`Params: (${P(n,{includeName:!0})})`,`Data:   ${e} (${s} bytes)`],name:"DecodeLogDataMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=t,this.data=e,this.params=n,this.size=s}}class W extends O{constructor({abiItem:t,param:e}){super([`Expected a topic for indexed event parameter${e.name?` "${e.name}"`:""} on event "${B(t,{includeName:!0})}".`].join("\n"),{name:"DecodeLogTopicsMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=t}}class q extends O{constructor(t,{docsPath:e}){super([`Type "${t}" is not a valid encoding type.`,"Please provide a valid ABI type."].join("\n"),{docsPath:e,name:"InvalidAbiEncodingType"})}}class G extends O{constructor(t,{docsPath:e}){super([`Type "${t}" is not a valid decoding type.`,"Please provide a valid ABI type."].join("\n"),{docsPath:e,name:"InvalidAbiDecodingType"})}}class X extends O{constructor(t){super([`Value "${t}" is not a valid array.`].join("\n"),{name:"InvalidArrayError"})}}class Y extends O{constructor(t){super([`"${t}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join("\n"),{name:"InvalidDefinitionTypeError"})}}class K extends O{constructor({address:t}){super(`Address "${t}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}class J extends O{constructor({offset:t,position:e,size:n}){super(`Slice ${"start"===e?"starting":"ending"} at offset "${t}" is out-of-bounds (size: ${n}).`,{name:"SliceOffsetOutOfBoundsError"})}}class Z extends O{constructor({size:t,targetSize:e,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${t}) exceeds padding size (${e}).`,{name:"SizeExceedsPaddingSizeError"})}}function Q(t,{dir:e,size:n=32}={}){return"string"==typeof t?tt(t,{dir:e,size:n}):function(t,{dir:e,size:n=32}={}){if(null===n)return t;if(t.length>n)throw new Z({size:t.length,targetSize:n,type:"bytes"});const s=new Uint8Array(n);for(let i=0;i<n;i++){const r="right"===e;s[r?i:n-i-1]=t[r?i:t.length-i-1]}return s}(t,{dir:e,size:n})}function tt(t,{dir:e,size:n=32}={}){if(null===n)return t;const s=t.replace("0x","");if(s.length>2*n)throw new Z({size:Math.ceil(s.length/2),targetSize:n,type:"hex"});return`0x${s["right"===e?"padEnd":"padStart"](2*n,"0")}`}class et extends O{constructor({max:t,min:e,signed:n,size:s,value:i}){super(`Number "${i}" is not in safe ${s?`${8*s}-bit ${n?"signed":"unsigned"} `:""}integer range ${t?`(${e} to ${t})`:`(above ${e})`}`,{name:"IntegerOutOfRangeError"})}}class nt extends O{constructor(t){super(`Bytes value "${t}" is not a valid boolean. The bytes array must contain a single byte of either a 0 or 1 value.`,{name:"InvalidBytesBooleanError"})}}class st extends O{constructor({givenSize:t,maxSize:e}){super(`Size cannot exceed ${e} bytes. Given size: ${t} bytes.`,{name:"SizeOverflowError"})}}function it(t,{dir:e="left"}={}){let n="string"==typeof t?t.replace("0x",""):t,s=0;for(let t=0;t<n.length-1&&"0"===n["left"===e?t:n.length-t-1].toString();t++)s++;return n="left"===e?n.slice(s):n.slice(0,n.length-s),"string"==typeof t?(1===n.length&&"right"===e&&(n=`${n}0`),`0x${n.length%2==1?`0${n}`:n}`):n}function rt(t,{size:e}){if(U(t)>e)throw new st({givenSize:U(t),maxSize:e})}function ot(t,e={}){const{signed:n}=e;e.size&&rt(t,{size:e.size});const s=BigInt(t);if(!n)return s;const i=(t.length-2)/2;return s<=(1n<<8n*BigInt(i)-1n)-1n?s:s-BigInt(`0x${"f".padStart(2*i,"f")}`)-1n}const at=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ct(t,e={}){const n=`0x${Number(t)}`;return"number"==typeof e.size?(rt(n,{size:e.size}),Q(n,{size:e.size})):n}function ut(t,e={}){let n="";for(let e=0;e<t.length;e++)n+=at[t[e]];const s=`0x${n}`;return"number"==typeof e.size?(rt(s,{size:e.size}),Q(s,{dir:"right",size:e.size})):s}function ht(t,e={}){const{signed:n,size:s}=e,i=BigInt(t);let r;s?r=n?(1n<<8n*BigInt(s)-1n)-1n:2n**(8n*BigInt(s))-1n:"number"==typeof t&&(r=BigInt(Number.MAX_SAFE_INTEGER));const o="bigint"==typeof r&&n?-r-1n:0;if(r&&i>r||i<o){const e="bigint"==typeof t?"n":"";throw new et({max:r?`${r}${e}`:void 0,min:`${o}${e}`,signed:n,size:s,value:`${t}${e}`})}const a=`0x${(n&&i<0?(1n<<BigInt(8*s))+BigInt(i):i).toString(16)}`;return s?Q(a,{size:s}):a}const lt=new TextEncoder;function ft(t,e={}){return ut(lt.encode(t),e)}const dt=new TextEncoder;function pt(t,e={}){return"number"==typeof t||"bigint"==typeof t?function(t,e){const n=ht(t,e);return mt(n)}(t,e):"boolean"==typeof t?function(t,e={}){const n=new Uint8Array(1);if(n[0]=Number(t),"number"==typeof e.size)return rt(n,{size:e.size}),Q(n,{size:e.size});return n}(t,e):E(t)?mt(t,e):bt(t,e)}const gt={zero:48,nine:57,A:65,F:70,a:97,f:102};function yt(t){return t>=gt.zero&&t<=gt.nine?t-gt.zero:t>=gt.A&&t<=gt.F?t-(gt.A-10):t>=gt.a&&t<=gt.f?t-(gt.a-10):void 0}function mt(t,e={}){let n=t;e.size&&(rt(n,{size:e.size}),n=Q(n,{dir:"right",size:e.size}));let s=n.slice(2);s.length%2&&(s=`0${s}`);const i=s.length/2,r=new Uint8Array(i);for(let t=0,e=0;t<i;t++){const n=yt(s.charCodeAt(e++)),i=yt(s.charCodeAt(e++));if(void 0===n||void 0===i)throw new O(`Invalid byte sequence ("${s[e-2]}${s[e-1]}" in "${s}").`);r[t]=16*n+i}return r}function bt(t,e={}){const n=dt.encode(t);return"number"==typeof e.size?(rt(n,{size:e.size}),Q(n,{dir:"right",size:e.size})):n}const wt=BigInt(2**32-1),vt=BigInt(32);function xt(t,e=!1){return e?{h:Number(t&wt),l:Number(t>>vt&wt)}:{h:0|Number(t>>vt&wt),l:0|Number(t&wt)}}function $t(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function At(t,...e){if(!((n=t)instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
var n;if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function It(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Bt(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Pt=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])()?t=>t:function(t){for(let e=0;e<t.length;e++)t[e]=Bt(t[e]);return t};function Et(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(t))}(t)),At(t),t}class Ut{}const kt=BigInt(0),Lt=BigInt(1),Nt=BigInt(2),Ot=BigInt(7),St=BigInt(256),jt=BigInt(113),Mt=[],Ct=[],Dt=[];for(let t=0,e=Lt,n=1,s=0;t<24;t++){[n,s]=[s,(2*n+3*s)%5],Mt.push(2*(5*s+n)),Ct.push((t+1)*(t+2)/2%64);let i=kt;for(let t=0;t<7;t++)e=(e<<Lt^(e>>Ot)*jt)%St,e&Nt&&(i^=Lt<<(Lt<<BigInt(t))-Lt);Dt.push(i)}const Tt=function(t,e=!1){const n=t.length;let s=new Uint32Array(n),i=new Uint32Array(n);for(let r=0;r<n;r++){const{h:n,l:o}=xt(t[r],e);[s[r],i[r]]=[n,o]}return[s,i]}(Dt,!0),Rt=Tt[0],Ft=Tt[1],_t=(t,e,n)=>n>32?((t,e,n)=>e<<n-32|t>>>64-n)(t,e,n):((t,e,n)=>t<<n|e>>>32-n)(t,e,n),Vt=(t,e,n)=>n>32?((t,e,n)=>t<<n-32|e>>>64-n)(t,e,n):((t,e,n)=>e<<n|t>>>32-n)(t,e,n);class Ht extends Ut{constructor(t,e,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=e,this.outputLen=n,this.enableXOF=s,this.rounds=i,$t(n),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");var r;this.state=new Uint8Array(200),this.state32=(r=this.state,new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)))}clone(){return this._cloneInto()}keccak(){Pt(this.state32),function(t,e=24){const n=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let e=0;e<10;e++)n[e]=t[e]^t[e+10]^t[e+20]^t[e+30]^t[e+40];for(let e=0;e<10;e+=2){const s=(e+8)%10,i=(e+2)%10,r=n[i],o=n[i+1],a=_t(r,o,1)^n[s],c=Vt(r,o,1)^n[s+1];for(let n=0;n<50;n+=10)t[e+n]^=a,t[e+n+1]^=c}let e=t[2],i=t[3];for(let n=0;n<24;n++){const s=Ct[n],r=_t(e,i,s),o=Vt(e,i,s),a=Mt[n];e=t[a],i=t[a+1],t[a]=r,t[a+1]=o}for(let e=0;e<50;e+=10){for(let s=0;s<10;s++)n[s]=t[e+s];for(let s=0;s<10;s++)t[e+s]^=~n[(s+2)%10]&n[(s+4)%10]}t[0]^=Rt[s],t[1]^=Ft[s]}zt(n)}(this.state32,this.rounds),Pt(this.state32),this.posOut=0,this.pos=0}update(t){It(this),At(t=Et(t));const{blockLen:e,state:n}=this,s=t.length;for(let i=0;i<s;){const r=Math.min(e-this.pos,s-i);for(let e=0;e<r;e++)n[this.pos++]^=t[i++];this.pos===e&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:e,pos:n,blockLen:s}=this;t[n]^=e,128&e&&n===s-1&&this.keccak(),t[s-1]^=128,this.keccak()}writeInto(t){It(this,!1),At(t),this.finish();const e=this.state,{blockLen:n}=this;for(let s=0,i=t.length;s<i;){this.posOut>=n&&this.keccak();const r=Math.min(n-this.posOut,i-s);t.set(e.subarray(this.posOut,this.posOut+r),s),this.posOut+=r,s+=r}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return $t(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(function(t,e){At(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,zt(this.state)}_cloneInto(t){const{blockLen:e,suffix:n,outputLen:s,rounds:i,enableXOF:r}=this;return t||(t=new Ht(e,n,s,r,i)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=i,t.suffix=n,t.outputLen=s,t.enableXOF=r,t.destroyed=this.destroyed,t}}const Wt=(t,e,n)=>function(t){const e=e=>t().update(Et(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}(()=>new Ht(e,t,n)),qt=(()=>Wt(1,136,32))();function Gt(t,e){const n=e||"hex",s=qt(E(t,{strict:!1})?pt(t):t);return"bytes"===n?s:function(t,e={}){return"number"==typeof t||"bigint"==typeof t?ht(t,e):"string"==typeof t?ft(t,e):"boolean"==typeof t?ct(t,e):ut(t,e)}(s)}class Xt extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const e=super.get(t);return super.has(t)&&void 0!==e&&(this.delete(t),super.set(t,e)),e}set(t,e){if(super.set(t,e),this.maxSize&&this.size>this.maxSize){const t=this.keys().next().value;t&&this.delete(t)}return this}}const Yt=/^0x[a-fA-F0-9]{40}$/,Kt=new Xt(8192);function Jt(t,e){const{strict:n=!0}=e??{},s=`${t}.${n}`;if(Kt.has(s))return Kt.get(s);const i=!(!Yt.test(t)||t.toLowerCase()!==t&&n&&Qt(t)!==t);return Kt.set(s,i),i}const Zt=new Xt(8192);function Qt(t,e){if(Zt.has(`${t}.${e}`))return Zt.get(`${t}.${e}`);const n=t.substring(2).toLowerCase(),s=Gt(bt(n),"bytes"),i=n.split("");for(let t=0;t<40;t+=2)s[t>>1]>>4>=8&&i[t]&&(i[t]=i[t].toUpperCase()),(15&s[t>>1])>=8&&i[t+1]&&(i[t+1]=i[t+1].toUpperCase());const r=`0x${i.join("")}`;return Zt.set(`${t}.${e}`,r),r}class te extends O{constructor({offset:t}){super(`Offset \`${t}\` cannot be negative.`,{name:"NegativeOffsetError"})}}class ee extends O{constructor({length:t,position:e}){super(`Position \`${e}\` is out of bounds (\`0 < position < ${t}\`).`,{name:"PositionOutOfBoundsError"})}}class ne extends O{constructor({count:t,limit:e}){super(`Recursive read limit of \`${e}\` exceeded (recursive read count: \`${t}\`).`,{name:"RecursiveReadLimitExceededError"})}}const se={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new ne({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(t){if(t<0||t>this.bytes.length-1)throw new ee({length:this.bytes.length,position:t})},decrementPosition(t){if(t<0)throw new te({offset:t});const e=this.position-t;this.assertPosition(e),this.position=e},getReadCount(t){return this.positionReadCount.get(t||this.position)||0},incrementPosition(t){if(t<0)throw new te({offset:t});const e=this.position+t;this.assertPosition(e),this.position=e},inspectByte(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectBytes(t,e){const n=e??this.position;return this.assertPosition(n+t-1),this.bytes.subarray(n,n+t)},inspectUint8(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectUint16(t){const e=t??this.position;return this.assertPosition(e+1),this.dataView.getUint16(e)},inspectUint24(t){const e=t??this.position;return this.assertPosition(e+2),(this.dataView.getUint16(e)<<8)+this.dataView.getUint8(e+2)},inspectUint32(t){const e=t??this.position;return this.assertPosition(e+3),this.dataView.getUint32(e)},pushByte(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushBytes(t){this.assertPosition(this.position+t.length-1),this.bytes.set(t,this.position),this.position+=t.length},pushUint8(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushUint16(t){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,t),this.position+=2},pushUint24(t){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,t>>8),this.dataView.setUint8(this.position+2,255&t),this.position+=3},pushUint32(t){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,t),this.position+=4},readByte(){this.assertReadLimit(),this._touch();const t=this.inspectByte();return this.position++,t},readBytes(t,e){this.assertReadLimit(),this._touch();const n=this.inspectBytes(t);return this.position+=e??t,n},readUint8(){this.assertReadLimit(),this._touch();const t=this.inspectUint8();return this.position+=1,t},readUint16(){this.assertReadLimit(),this._touch();const t=this.inspectUint16();return this.position+=2,t},readUint24(){this.assertReadLimit(),this._touch();const t=this.inspectUint24();return this.position+=3,t},readUint32(){this.assertReadLimit(),this._touch();const t=this.inspectUint32();return this.position+=4,t},get remaining(){return this.bytes.length-this.position},setPosition(t){const e=this.position;return this.assertPosition(t),this.position=t,()=>this.position=e},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;const t=this.getReadCount();this.positionReadCount.set(this.position,t+1),t>0&&this.recursiveReadCount++}};function ie(t,e,n,{strict:s}={}){return E(t,{strict:!1})?function(t,e,n,{strict:s}={}){re(t,e);const i=`0x${t.replace("0x","").slice(2*(e??0),2*(n??t.length))}`;s&&oe(i,e,n);return i}(t,e,n,{strict:s}):ae(t,e,n,{strict:s})}function re(t,e){if("number"==typeof e&&e>0&&e>U(t)-1)throw new J({offset:e,position:"start",size:U(t)})}function oe(t,e,n){if("number"==typeof e&&"number"==typeof n&&U(t)!==n-e)throw new J({offset:n,position:"end",size:U(t)})}function ae(t,e,n,{strict:s}={}){re(t,e);const i=t.slice(e,n);return s&&oe(i,e,n),i}function ce(t,e={}){void 0!==e.size&&rt(t,{size:e.size});return ot(ut(t,e),e)}function ue(t,e={}){let n=t;if(void 0!==e.size&&(rt(n,{size:e.size}),n=it(n)),n.length>1||n[0]>1)throw new nt(n);return Boolean(n[0])}function he(t,e={}){void 0!==e.size&&rt(t,{size:e.size});return function(t,e={}){return Number(ot(t,e))}(ut(t,e),e)}function le(t){return"string"==typeof t[0]?function(t){return`0x${t.reduce((t,e)=>t+e.replace("0x",""),"")}`}(t):function(t){let e=0;for(const n of t)e+=n.length;const n=new Uint8Array(e);let s=0;for(const e of t)n.set(e,s),s+=e.length;return n}(t)}const fe=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function de(t,e){if(t.length!==e.length)throw new T({expectedLength:t.length,givenLength:e.length});const n=function({params:t,values:e}){const n=[];for(let s=0;s<t.length;s++)n.push(pe({param:t[s],value:e[s]}));return n}({params:t,values:e}),s=ge(n);return 0===s.length?"0x":s}function pe({param:t,value:e}){const n=ye(t.type);if(n){const[s,i]=n;return function(t,{length:e,param:n}){const s=null===e;if(!Array.isArray(t))throw new X(t);if(!s&&t.length!==e)throw new C({expectedLength:e,givenLength:t.length,type:`${n.type}[${e}]`});let i=!1;const r=[];for(let e=0;e<t.length;e++){const s=pe({param:n,value:t[e]});s.dynamic&&(i=!0),r.push(s)}if(s||i){const t=ge(r);if(s){const e=ht(r.length,{size:32});return{dynamic:!0,encoded:r.length>0?le([e,t]):e}}if(i)return{dynamic:!0,encoded:t}}return{dynamic:!1,encoded:le(r.map(({encoded:t})=>t))}}(e,{length:s,param:{...t,type:i}})}if("tuple"===t.type)return function(t,{param:e}){let n=!1;const s=[];for(let i=0;i<e.components.length;i++){const r=e.components[i],o=pe({param:r,value:t[Array.isArray(t)?i:r.name]});s.push(o),o.dynamic&&(n=!0)}return{dynamic:n,encoded:n?ge(s):le(s.map(({encoded:t})=>t))}}(e,{param:t});if("address"===t.type)return function(t){if(!Jt(t))throw new K({address:t});return{dynamic:!1,encoded:tt(t.toLowerCase())}}(e);if("bool"===t.type)return function(t){if("boolean"!=typeof t)throw new O(`Invalid boolean value: "${t}" (type: ${typeof t}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:tt(ct(t))}}(e);if(t.type.startsWith("uint")||t.type.startsWith("int")){const n=t.type.startsWith("int"),[,,s="256"]=fe.exec(t.type)??[];return function(t,{signed:e,size:n=256}){if("number"==typeof n){const s=2n**(BigInt(n)-(e?1n:0n))-1n,i=e?-s-1n:0n;if(t>s||t<i)throw new et({max:s.toString(),min:i.toString(),signed:e,size:n/8,value:t.toString()})}return{dynamic:!1,encoded:ht(t,{size:32,signed:e})}}(e,{signed:n,size:Number(s)})}if(t.type.startsWith("bytes"))return function(t,{param:e}){const[,n]=e.type.split("bytes"),s=U(t);if(!n){let e=t;return s%32!=0&&(e=tt(e,{dir:"right",size:32*Math.ceil((t.length-2)/2/32)})),{dynamic:!0,encoded:le([tt(ht(s,{size:32})),e])}}if(s!==Number.parseInt(n,10))throw new D({expectedSize:Number.parseInt(n,10),value:t});return{dynamic:!1,encoded:tt(t,{dir:"right"})}}(e,{param:t});if("string"===t.type)return function(t){const e=ft(t),n=Math.ceil(U(e)/32),s=[];for(let t=0;t<n;t++)s.push(tt(ie(e,32*t,32*(t+1)),{dir:"right"}));return{dynamic:!0,encoded:le([tt(ht(U(e),{size:32})),...s])}}(e);throw new q(t.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function ge(t){let e=0;for(let n=0;n<t.length;n++){const{dynamic:s,encoded:i}=t[n];e+=s?32:U(i)}const n=[],s=[];let i=0;for(let r=0;r<t.length;r++){const{dynamic:o,encoded:a}=t[r];o?(n.push(ht(e+i,{size:32})),s.push(a),i+=U(a)):n.push(a)}return le([...n,...s])}function ye(t){const e=t.match(/^(.*)\[(\d+)?\]$/);return e?[e[2]?Number(e[2]):null,e[1]]:void 0}function me(t,e){const n="string"==typeof e?mt(e):e,s=function(t,{recursiveReadLimit:e=8192}={}){const n=Object.create(se);return n.bytes=t,n.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),n.positionReadCount=new Map,n.recursiveReadLimit=e,n}(n);if(0===U(n)&&t.length>0)throw new M;if(U(e)&&U(e)<32)throw new j({data:"string"==typeof e?e:ut(e),params:t,size:U(e)});let i=0;const r=[];for(let e=0;e<t.length;++e){const n=t[e];s.setPosition(i);const[o,a]=be(s,n,{staticPosition:0});i+=a,r.push(o)}return r}function be(t,e,{staticPosition:n}){const s=ye(e.type);if(s){const[i,r]=s;return function(t,e,{length:n,staticPosition:s}){if(!n){const n=s+he(t.readBytes(ve)),i=n+we;t.setPosition(n);const r=he(t.readBytes(we)),o=xe(e);let a=0;const c=[];for(let n=0;n<r;++n){t.setPosition(i+(o?32*n:a));const[s,r]=be(t,e,{staticPosition:i});a+=r,c.push(s)}return t.setPosition(s+32),[c,32]}if(xe(e)){const i=s+he(t.readBytes(ve)),r=[];for(let s=0;s<n;++s){t.setPosition(i+32*s);const[n]=be(t,e,{staticPosition:i});r.push(n)}return t.setPosition(s+32),[r,32]}let i=0;const r=[];for(let o=0;o<n;++o){const[n,o]=be(t,e,{staticPosition:s+i});i+=o,r.push(n)}return[r,i]}(t,{...e,type:r},{length:i,staticPosition:n})}if("tuple"===e.type)return function(t,e,{staticPosition:n}){const s=0===e.components.length||e.components.some(({name:t})=>!t),i=s?[]:{};let r=0;if(xe(e)){const o=n+he(t.readBytes(ve));for(let n=0;n<e.components.length;++n){const a=e.components[n];t.setPosition(o+r);const[c,u]=be(t,a,{staticPosition:o});r+=u,i[s?n:a?.name]=c}return t.setPosition(n+32),[i,32]}for(let o=0;o<e.components.length;++o){const a=e.components[o],[c,u]=be(t,a,{staticPosition:n});i[s?o:a?.name]=c,r+=u}return[i,r]}(t,e,{staticPosition:n});if("address"===e.type)return function(t){const e=t.readBytes(32);return[Qt(ut(ae(e,-20))),32]}(t);if("bool"===e.type)return function(t){return[ue(t.readBytes(32),{size:32}),32]}(t);if(e.type.startsWith("bytes"))return function(t,e,{staticPosition:n}){const[s,i]=e.type.split("bytes");if(!i){const e=he(t.readBytes(32));t.setPosition(n+e);const s=he(t.readBytes(32));if(0===s)return t.setPosition(n+32),["0x",32];const i=t.readBytes(s);return t.setPosition(n+32),[ut(i),32]}const r=ut(t.readBytes(Number.parseInt(i,10),32));return[r,32]}(t,e,{staticPosition:n});if(e.type.startsWith("uint")||e.type.startsWith("int"))return function(t,e){const n=e.type.startsWith("int"),s=Number.parseInt(e.type.split("int")[1]||"256",10),i=t.readBytes(32);return[s>48?ce(i,{signed:n}):he(i,{signed:n}),32]}(t,e);if("string"===e.type)return function(t,{staticPosition:e}){const n=he(t.readBytes(32)),s=e+n;t.setPosition(s);const i=he(t.readBytes(32));if(0===i)return t.setPosition(e+32),["",32];const r=t.readBytes(i,32),o=function(t,e={}){let n=t;return void 0!==e.size&&(rt(n,{size:e.size}),n=it(n,{dir:"right"})),(new TextDecoder).decode(n)}(it(r));return t.setPosition(e+32),[o,32]}(t,{staticPosition:n});throw new G(e.type,{docsPath:"/docs/contract/decodeAbiParameters"})}const we=32,ve=32;function xe(t){const{type:e}=t;if("string"===e)return!0;if("bytes"===e)return!0;if(e.endsWith("[]"))return!0;if("tuple"===e)return t.components?.some(xe);const n=ye(t.type);return!(!n||!xe({...t,type:n[1]}))}function $e(t){return Gt(pt(t))}const Ae=/^tuple(?<array>(\[(\d*)\])*)$/;function Ie(t){let e=t.type;if(Ae.test(t.type)&&"components"in t){e="(";const n=t.components.length;for(let s=0;s<n;s++){e+=Ie(t.components[s]),s<n-1&&(e+=", ")}const s=function(t,e){const n=t.exec(e);return n?.groups}(Ae,t.type);return e+=`)${s?.array??""}`,Ie({...t,type:e})}return"indexed"in t&&t.indexed&&(e=`${e} indexed`),t.name?`${e} ${t.name}`:e}function ze(t){let e="";const n=t.length;for(let s=0;s<n;s++){e+=Ie(t[s]),s!==n-1&&(e+=", ")}return e}const Be=t=>{var e;return function(t){let e=!0,n="",s=0,i="",r=!1;for(let o=0;o<t.length;o++){const a=t[o];if(["(",")",","].includes(a)&&(e=!0),"("===a&&s++,")"===a&&s--,e)if(0!==s)" "!==a?(i+=a,n+=a):","!==t[o-1]&&","!==n&&",("!==n&&(n="",e=!1);else if(" "===a&&["event","function",""].includes(i))i="";else if(i+=a,")"===a){r=!0;break}}if(!r)throw new O("Unable to normalize signature.");return i}("string"==typeof t?t:"function"===(e=t).type?`function ${e.name}(${ze(e.inputs)})${e.stateMutability&&"nonpayable"!==e.stateMutability?` ${e.stateMutability}`:""}${e.outputs?.length?` returns (${ze(e.outputs)})`:""}`:"event"===e.type?`event ${e.name}(${ze(e.inputs)})`:"error"===e.type?`error ${e.name}(${ze(e.inputs)})`:"constructor"===e.type?`constructor(${ze(e.inputs)})${"payable"===e.stateMutability?" payable":""}`:"fallback"===e.type?"fallback() external"+("payable"===e.stateMutability?" payable":""):"receive() external payable")};function Pe(t){return $e(Be(t))}const Ee=Pe;function Ue(t){const{abi:e,args:n=[],name:s}=t,i=E(s,{strict:!1}),r=e.filter(t=>i?"function"===t.type?ie(Pe(t),0,4)===s:"event"===t.type&&Ee(t)===s:"name"in t&&t.name===s);if(0===r.length)return;if(1===r.length)return r[0];let o;for(const t of r){if(!("inputs"in t))continue;if(!n||0===n.length){if(!t.inputs||0===t.inputs.length)return t;continue}if(!t.inputs)continue;if(0===t.inputs.length)continue;if(t.inputs.length!==n.length)continue;if(n.every((e,n)=>{const s="inputs"in t&&t.inputs[n];return!!s&&ke(e,s)})){if(o&&"inputs"in o&&o.inputs){const e=Le(t.inputs,o.inputs,n);if(e)throw new V({abiItem:t,type:e[0]},{abiItem:o,type:e[1]})}o=t}}return o||r[0]}function ke(t,e){const n=typeof t,s=e.type;switch(s){case"address":return Jt(t,{strict:!1});case"bool":return"boolean"===n;case"function":case"string":return"string"===n;default:return"tuple"===s&&"components"in e?Object.values(e.components).every((e,n)=>ke(Object.values(t)[n],e)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?"number"===n||"bigint"===n:/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?"string"===n||t instanceof Uint8Array:!!/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)&&(Array.isArray(t)&&t.every(t=>ke(t,{...e,type:s.replace(/(\[[0-9]{0,}\])$/,"")})))}}function Le(t,e,n){for(const s in t){const i=t[s],r=e[s];if("tuple"===i.type&&"tuple"===r.type&&"components"in i&&"components"in r)return Le(i.components,r.components,n[s]);const o=[i.type,r.type];if((()=>!(!o.includes("address")||!o.includes("bytes20"))||(o.includes("address")&&o.includes("string")||!(!o.includes("address")||!o.includes("bytes")))&&Jt(n[s],{strict:!1}))())return o}}class Ne extends O{constructor(t){super(`Filter type "${t}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const Oe="/docs/contract/encodeEventTopics";function Se({param:t,value:e}){if("string"===t.type||"bytes"===t.type)return Gt(pt(e));if("tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/))throw new Ne(t.type);return de([t],[e])}const je=new Map,Me=new Map;async function Ce(t,{cacheKey:e,cacheTime:n=Number.POSITIVE_INFINITY}){const s=function(t){const e=(t,e)=>({clear:()=>e.delete(t),get:()=>e.get(t),set:n=>e.set(t,n)}),n=e(t,je),s=e(t,Me);return{clear:()=>{n.clear(),s.clear()},promise:n,response:s}}(e),i=s.response.get();if(i&&n>0){if(Date.now()-i.created.getTime()<n)return i.data}let r=s.promise.get();r||(r=t(),s.promise.set(r));try{const t=await r;return s.response.set({created:new Date,data:t}),t}finally{s.promise.clear()}}const De="/docs/contract/decodeEventLog";function Te({param:t,value:e}){if("string"===t.type||"bytes"===t.type||"tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/))return e;return(me([t],e)||[])[0]}function Re(t){const{abi:e,args:n,logs:s,strict:i=!0}=t,r=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return s.map(t=>{try{const s=e.find(e=>"event"===e.type&&t.topics[0]===Ee(e));if(!s)return null;const o=function(t){const{abi:e,data:n,strict:s,topics:i}=t,r=s??!0,[o,...a]=i;if(!o)throw new R({docsPath:De});const c=e.find(t=>"event"===t.type&&o===Ee(B(t)));if(!c||!("name"in c)||"event"!==c.type)throw new F(o,{docsPath:De});const{name:u,inputs:h}=c,l=h?.some(t=>!("name"in t&&t.name)),f=l?[]:{},d=h.map((t,e)=>[t,e]).filter(([t])=>"indexed"in t&&t.indexed);for(let t=0;t<d.length;t++){const[e,n]=d[t],s=a[t];if(!s)throw new W({abiItem:c,param:e});f[l?n:e.name||n]=Te({param:e,value:s})}const p=h.filter(t=>!("indexed"in t&&t.indexed));if(p.length>0)if(n&&"0x"!==n)try{const t=me(p,n);if(t)if(l)for(let e=0;e<h.length;e++)f[e]=f[e]??t.shift();else for(let e=0;e<p.length;e++)f[p[e].name]=t[e]}catch(t){if(r){if(t instanceof j||t instanceof ee)throw new H({abiItem:c,data:n,params:p,size:U(n)});throw t}}else if(r)throw new H({abiItem:c,data:"0x",params:p,size:0});return{eventName:u,args:Object.values(f).length>0?f:void 0}}({...t,abi:[s],strict:i});return r&&!r.includes(o.eventName)?null:function(t){const{args:e,inputs:n,matchArgs:s}=t;if(!s)return!0;if(!e)return!1;function i(t,e,n){try{return"address"===t.type?function(t,e){if(!Jt(t,{strict:!1}))throw new K({address:t});if(!Jt(e,{strict:!1}))throw new K({address:e});return t.toLowerCase()===e.toLowerCase()}(e,n):"string"===t.type||"bytes"===t.type?Gt(pt(e))===n:e===n}catch{return!1}}if(Array.isArray(e)&&Array.isArray(s))return s.every((t,s)=>{if(null==t)return!0;const r=n[s];if(!r)return!1;return(Array.isArray(t)?t:[t]).some(t=>i(r,t,e[s]))});return"object"==typeof e&&!Array.isArray(e)&&"object"==typeof s&&!Array.isArray(s)&&Object.entries(s).every(([t,s])=>{if(null==s)return!0;const r=n.find(e=>e.name===t);if(!r)return!1;return(Array.isArray(s)?s:[s]).some(n=>i(r,n,e[t]))})}({args:o.args,inputs:s.inputs,matchArgs:n})?{...o,...t}:null}catch(e){let n,s;if(e instanceof F)return null;if(e instanceof H||e instanceof W){if(i)return null;n=e.abiItem.name,s=e.abiItem.inputs?.some(t=>!("name"in t&&t.name))}return{...t,args:s?[]:{},eventName:n}}}).filter(Boolean)}async function Fe(t,{address:e,blockHash:n,fromBlock:s,toBlock:i,event:r,events:o,args:a,strict:c}={}){const u=c??!1,h=o??(r?[r]:void 0);let l,f=[];if(h){const t=h.flatMap(t=>function(t){const{abi:e,eventName:n,args:s}=t;let i=e[0];if(n){const t=Ue({abi:e,name:n});if(!t)throw new _(n,{docsPath:Oe});i=t}if("event"!==i.type)throw new _(void 0,{docsPath:Oe});const r=B(i),o=Ee(r);let a=[];if(s&&"inputs"in i){const t=i.inputs?.filter(t=>"indexed"in t&&t.indexed),e=Array.isArray(s)?s:Object.values(s).length>0?t?.map(t=>s[t.name])??[]:[];e.length>0&&(a=t?.map((t,n)=>Array.isArray(e[n])?e[n].map((s,i)=>Se({param:t,value:e[n][i]})):void 0!==e[n]&&null!==e[n]?Se({param:t,value:e[n]}):null)??[])}return[o,...a]}({abi:[t],eventName:t.name,args:o?void 0:a}));f=[t],r&&(f=f[0])}l=n?await t.request({method:"eth_getLogs",params:[{address:e,topics:f,blockHash:n}]}):await t.request({method:"eth_getLogs",params:[{address:e,topics:f,fromBlock:"bigint"==typeof s?ht(s):s,toBlock:"bigint"==typeof i?ht(i):i}]});const d=l.map(t=>function(t,{args:e,eventName:n}={}){return{...t,blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,logIndex:t.logIndex?Number(t.logIndex):null,transactionHash:t.transactionHash?t.transactionHash:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null,...n?{args:e,eventName:n}:{}}}(t));return h?Re({abi:h,args:a,logs:d,strict:u}):d}function _e(t){const e=[];for(;t>=128;)e.push(127&t|128),t>>>=7;return e.push(t),new Uint8Array(e)}function Ve(t,e){const n=function(t){const e=Buffer.alloc(4);return e.writeUInt32BE(t,0),new Uint8Array(e)}(e),s=new Uint8Array(t.length+n.length);return s.set(t,0),s.set(n,t.length),s}function He(t,e){const n=new Uint8Array([10]),s=_e(t.length),i=new Uint8Array([16]),r=_e(e),o=n.length+s.length+t.length+i.length+r.length,a=new Uint8Array(o);let c=0;a.set(n,c),c+=n.length,a.set(s,c),c+=s.length,a.set(t,c),c+=t.length,a.set(i,c),c+=i.length,a.set(r,c);const u=new Uint8Array([10]),h=_e(a.length),l=new Uint8Array(u.length+h.length+a.length);return c=0,l.set(u,c),c+=u.length,l.set(h,c),c+=h.length,l.set(a,c),l}function We(t){const e=new Uint8Array([18]),n=_e(t.length),s=new Uint8Array(e.length+n.length+t.length);return s.set(e,0),s.set(n,e.length),s.set(t,e.length+n.length),s}const qe=i("event SendWarpMessage(address indexed sourceAddress, bytes32 indexed unsignedMessageID, bytes message)"),Ge="0x0200000000000000000000000000000000000005";async function Xe(e,n){const s=n.maxBootstrapValidators??100,{validationID:i,subnetIDStr:o}=n;let a,c,u;try{if(!i)throw new Error("Found empty validationID");if(c=i.startsWith("0x")?i:t.bufferToHex(t.base58check.decode(i)),a=r(c),32!==a.length)throw new Error(`Decoded validationID must be 32 bytes, got ${a.length}`)}catch(t){return{justification:null,error:`Failed to decode provided validationIDHex '${c}': ${t.message}`}}try{if(!o)throw new Error("Found empty subnetIDStr");u=t.base58check.decode(o)}catch(t){return{justification:null,error:`Failed to decode provided SubnetID: ${o}: ${t.message}`}}for(let e=0;e<s;e++){const n=Ve(u,e),s=z(n);if(t.bytesEqual(s,a)){return{justification:He(u,e)}}}return await async function(t,e,n,s){const i=2e3,r=100,o=e.maxChunks??r,a=e.searchOrder??"desc",c=e.chunkSize??i;try{const i=await async function(t,{cacheTime:e=t.cacheTime}={}){const n=await Ce(()=>t.request({method:"eth_blockNumber"}),{cacheKey:(s=t.uid,`blockNumber.${s}`),cacheTime:e});var s;return BigInt(n)}(t);let r="latest"===e.startBlock||void 0===e.startBlock?i:BigInt(e.startBlock),u=0;for(;u<o;){const{fromBlock:e,toBlock:o,shouldStopAfter:h}=Ye(r,c,a,i),l=await Fe(t,{address:Ge,event:qe,fromBlock:BigInt(e),toBlock:BigInt(o)});if(l.length>0){const t=Ke(l.slice().reverse(),n,s);if(t)return{justification:t}}if(h)break;if(r="desc"===a?BigInt(e)-1n:BigInt(o)+1n,"asc"===a&&r>i)break;u++}return{justification:null}}catch(t){return{justification:null,error:`Error fetching or decoding logs for ValidationID ${s}: ${t}`}}}(e,n,a,c)}function Ye(t,e,n,s){if("desc"===n){const n=Math.max(0,Number(t)-e+1);return{fromBlock:n,toBlock:Number(t),shouldStopAfter:0===n}}{const n=Number(t),i=Math.min(Number(s),Number(t)+e-1);return{fromBlock:n,toBlock:i,shouldStopAfter:i>=Number(s)}}}function Ke(i,r,o){const a=e.warp.getWarpManager();for(const o of i)try{const i=o,c=i.args?.message;if(!c)continue;const u=Buffer.from(c.slice(2),"hex"),h=a.unpack(u,e.warp.WarpUnsignedMessage),l=a.unpack(t.hexToBuffer(h.payload.toJSON()),e.warp.AddressedCallPayloads.AddressedCall),f=t.hexToBuffer(l.getPayload());if(!f)continue;const[,d]=n.fromBytes(f),[p]=s.fromBytes(d);if(1!==p.value())continue;try{const s=a.unpack(f,e.warp.AddressedCallPayloads.RegisterL1ValidatorMessage).toBytes(e.warp.codec),i=Uint8Array.from([...new n(0).toBytes(),...s]),o=z(i);if(t.bytesEqual(o,r)){return We(f)}}catch(t){}}catch(t){}return null}export{o as baseFee,u as feeConfig,h as getActiveRulesAt,a as getChainConfig,Xe as getRegistrationJustification,c as maxPriorityFeePerGas};
